# ç™»å½•åè°ƒç”¨ Rayware å›¾è¿›è¡Œæ–°å»ºæ‰“å°ä»»åŠ¡

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨æ¡†æ¶å®ç°ç™»å½•åè‡ªåŠ¨è°ƒç”¨ rayware å›¾è¿›è¡Œæ–°å»ºæ‰“å°ä»»åŠ¡çš„åŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æ¡†æ¶æ”¯æŒä»¥ä¸‹å®Œæ•´æµç¨‹ï¼š
1. **ç”¨æˆ·ç™»å½•** - ä½¿ç”¨é…ç½®çš„è´¦å·è‡ªåŠ¨ç™»å½•
2. **æ„å›¾è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¦æ‰§è¡Œçš„æ“ä½œ
3. **è°ƒç”¨ Rayware å›¾** - ç™»å½•æˆåŠŸåè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„ä¸šåŠ¡å›¾
4. **æ‰§è¡Œä¸šåŠ¡æ“ä½œ** - åœ¨ Rayware ç³»ç»Ÿä¸­æ‰§è¡Œå…·ä½“æ“ä½œ

## ğŸ“‹ æ”¯æŒçš„æŒ‡ä»¤æ ¼å¼

### ç™»å½• + æ–°å»ºæ‰“å°ä»»åŠ¡
```
ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡
è¯·ç”¨user1ç™»å½•ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„æ‰“å°ä»»åŠ¡
ç”¨wangyiliç™»å½•ï¼Œæˆ‘è¦æ–°å»ºæ‰“å°ä»»åŠ¡
wangyiliç™»å½•åæ–°å»ºæ‰“å°ä»»åŠ¡
```

### ç™»å½• + æŸ¥çœ‹å†å²
```
ç”¨wangyiliç™»å½•å¹¶æŸ¥çœ‹æ‰“å°å†å²
è¯·ç”¨user1ç™»å½•ç„¶åæŸ¥çœ‹æœ€è¿‘çš„æ‰“å°ä»»åŠ¡
ç”¨wangyiliç™»å½•ï¼Œæˆ‘è¦æŸ¥çœ‹å†å²
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®æµè½¬å›¾

```
ç”¨æˆ·è¾“å…¥ â†’ ä¸»å›¾å¤„ç† â†’ LLMè§£æ â†’ ç™»å½•å·¥å…·æ‰§è¡Œ â†’ ç™»å½•æˆåŠŸæ£€æŸ¥ â†’ Raywareå›¾è°ƒç”¨ â†’ ä¸šåŠ¡æ“ä½œæ‰§è¡Œ
```

### 2. å…³é”®ç»„ä»¶

#### ä¸»å›¾ (main_graph.py)
- è´Ÿè´£æ•´ä½“æµç¨‹æ§åˆ¶
- æ£€æµ‹ç™»å½•æˆåŠŸåçš„åç»­æ“ä½œæ„å›¾
- è‡ªåŠ¨è°ƒç”¨ rayware å›¾

#### Rayware å›¾ (rayware_graph.py)
- ä¸“é—¨å¤„ç† Rayware ç³»ç»Ÿçš„ä¸šåŠ¡æ“ä½œ
- æ”¯æŒæ–°å»ºæ‰“å°ä»»åŠ¡ã€æŸ¥çœ‹å†å²ç­‰åŠŸèƒ½
- åŒ…å«å®Œæ•´çš„é¡µé¢å¯¼èˆªå’Œè¡¨å•å¡«å†™é€»è¾‘

#### ç™»å½•å·¥å…· (web_toolkit.py)
- `auto_login()` - æ ¹æ®ç”¨æˆ·æè¿°è‡ªåŠ¨ç™»å½•
- `login_with_credentials()` - ä½¿ç”¨å…·ä½“å‡­æ®ç™»å½•

### 3. æ ¸å¿ƒä»£ç é€»è¾‘

#### ä¸»å›¾ä¸­çš„ç™»å½•åå¤„ç†é€»è¾‘
```python
# æ£€æŸ¥æ˜¯å¦æ˜¯ç™»å½•æˆåŠŸ
if tool_call["name"] in ["auto_login", "login_with_credentials"]:
    if isinstance(result, dict) and result.get("status") == "success":
        # æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦åŒ…å«åç»­æ“ä½œæ„å›¾
        user_input = state.get("input", "")
        if any(keyword in user_input for keyword in ['æ–°å»º', 'æ‰“å°ä»»åŠ¡', 'åˆ›å»º', 'æ–°å¢']):
            # è°ƒç”¨ rayware å›¾
            rayware_result = rayware_module_graph.invoke(state)
```

#### Rayware å›¾çš„ä¸šåŠ¡æµç¨‹
```python
# æ„å›¾åˆ†ç±» â†’ å¯¼èˆªåˆ°Rayware â†’ åˆ›å»ºæ‰“å°ä»»åŠ¡ â†’ æäº¤ä»»åŠ¡
classify_intent â†’ navigate_to_rayware â†’ create_new_print_job â†’ submit_print_job
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ç›´æ¥è¿è¡Œä¸»ç¨‹åº
```bash
python agent_runner_new.py
```
ç„¶åè¾“å…¥æŒ‡ä»¤ï¼š
```
> ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡
```

### æ–¹æ³•2: ä½¿ç”¨ç¤ºä¾‹è„šæœ¬
```bash
python examples/login_and_create_print_job.py
```

### æ–¹æ³•3: ç¼–ç¨‹è°ƒç”¨
```python
from langchain_core.messages import HumanMessage
from graphs.main_graph import main_graph

# åˆ›å»ºçŠ¶æ€
state = {
    "messages": [HumanMessage(content="ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡")],
    "input": "ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡",
    # ... å…¶ä»–çŠ¶æ€å­—æ®µ
}

# æ‰§è¡Œå¤„ç†
result = main_graph.process(state)
```

## âš™ï¸ é…ç½®è¯´æ˜

### è´¦å·é…ç½® (config.yaml)
```yaml
accounts:
  - description: "wangyili"
    url: "https://dev.account.sprintray.com/"
    username: "wangyili@sprintray.cn"
    password: "password456"
  - description: "user1"
    url: "https://dev.account.sprintray.com/"
    username: "zhufeng@sprintray.cn"
    password: "xunshi@123"
```

### Design Service ç³»ç»Ÿé…ç½®
```yaml
design_service:
  base_url: "https://dev.designservice.sprintray.com"
  urls:
    home: "https://dev.designservice.sprintray.com/home-screen"
    rayware: "https://dev.designservice.sprintray.com/print-setup"
    print_history: "https://dev.designservice.sprintray.com/print-history"
    new_print_job: "https://dev.designservice.sprintray.com/print-setup"
  page_indicators:
    rayware_home: ["print-setup", "designservice.sprintray.com"]
    print_setup: ["print-setup"]
    print_history: ["print-history"]
```

### é…ç½®ç»“æ„è¯´æ˜

1. **design_service**: ä¸»é…ç½®èŠ‚ç‚¹ï¼ŒåŒ…å«æ•´ä¸ª Design Service ç³»ç»Ÿçš„é…ç½®
2. **base_url**: Design Service ç³»ç»Ÿçš„åŸºç¡€URL
3. **urls**: å„ä¸ªåŠŸèƒ½é¡µé¢çš„å…·ä½“URL
   - `home`: é¦–é¡µ
   - `rayware`: Rayware æ‰“å°è®¾ç½®é¡µé¢
   - `print_history`: æ‰“å°å†å²é¡µé¢
   - `new_print_job`: æ–°å»ºæ‰“å°ä»»åŠ¡é¡µé¢ï¼ˆé€šå¸¸ä¸ rayware ç›¸åŒï¼‰
4. **page_indicators**: ç”¨äºè‡ªåŠ¨è¯†åˆ«å½“å‰é¡µé¢ç±»å‹çš„å…³é”®è¯

### æ„å›¾è·¯ç”±é…ç½®
```yaml
intent_routing:
  new_print_job:
    keywords: ["æ–°å»º", "æ‰“å°ä»»åŠ¡", "æ–°å»ºæ‰“å°ä»»åŠ¡", "åˆ›å»ºæ‰“å°"]
    description: "ç”¨æˆ·æƒ³è¦åˆ›å»ºæ–°çš„æ‰“å°ä»»åŠ¡"
  
  recent_print_jobs:
    keywords: ["æœ€è¿‘", "å†å²", "æŸ¥çœ‹", "æ‰“å°å†å²", "æŸ¥çœ‹å†å²"]
    description: "ç”¨æˆ·æƒ³è¦æŸ¥çœ‹æœ€è¿‘çš„æ‰“å°ä»»åŠ¡"
```

### é…ç½®ç®¡ç†ä¼˜åŠ¿

1. **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰ URL é…ç½®åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä¾¿äºç»´æŠ¤
2. **ç¯å¢ƒåˆ‡æ¢**ï¼šå¯ä»¥è½»æ¾åˆ‡æ¢å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒ
3. **æ™ºèƒ½è¯†åˆ«**ï¼šé€šè¿‡ `page_indicators` è‡ªåŠ¨è¯†åˆ«å½“å‰é¡µé¢ç±»å‹
4. **çµæ´»æ‰©å±•**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„é¡µé¢å’ŒURL

### é…ç½®éªŒè¯

è¿è¡Œé…ç½®éªŒè¯è„šæœ¬ç¡®ä¿é…ç½®æ­£ç¡®ï¼š
```bash
python scripts/validate_config.py
```

è¯¥è„šæœ¬ä¼šéªŒè¯ï¼š
- LLM é…ç½®å®Œæ•´æ€§
- è´¦å·é…ç½®æ­£ç¡®æ€§
- Rayware URL æ ¼å¼å’Œå¯è®¿é—®æ€§
- æµè§ˆå™¨é…ç½®æœ‰æ•ˆæ€§
- é…ç½®æ–¹æ³•åŠŸèƒ½æµ‹è¯•

## ğŸ” æ‰§è¡Œæµç¨‹è¯¦è§£

### 1. ç”¨æˆ·è¾“å…¥è§£æ
```
è¾“å…¥: "ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡"
â†“
è§£æå‡º: 
- ç™»å½•ç”¨æˆ·: wangyili
- åç»­æ“ä½œ: æ–°å»ºæ‰“å°ä»»åŠ¡
```

### 2. ç™»å½•æ‰§è¡Œ
```
auto_login(user_desc="wangyili")
â†“
æŸ¥æ‰¾è´¦å·é…ç½® â†’ æ‰“å¼€ç™»å½•é¡µ â†’ è¾“å…¥å‡­æ® â†’ éªŒè¯ç™»å½•
```

### 3. æ„å›¾æ£€æµ‹
```
æ£€æŸ¥ç”¨æˆ·è¾“å…¥ä¸­çš„å…³é”®è¯:
['æ–°å»º', 'æ‰“å°ä»»åŠ¡', 'åˆ›å»º', 'æ–°å¢'] â†’ è§¦å‘æ–°å»ºæ‰“å°ä»»åŠ¡æµç¨‹
```

### 4. Rayware å›¾è°ƒç”¨
```
rayware_module_graph.invoke(state)
â†“
classify_intent â†’ navigate_to_rayware â†’ create_new_print_job â†’ submit_print_job
```

### 5. ä¸šåŠ¡æ“ä½œæ‰§è¡Œ
```
å¯¼èˆªåˆ° Rayware â†’ ç‚¹å‡»æ–°å»ºæŒ‰é’® â†’ å¡«å†™è¡¨å• â†’ æäº¤ä»»åŠ¡
```

## ğŸ› ï¸ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°çš„ä¸šåŠ¡æ“ä½œ
1. åœ¨ `rayware_graph.py` ä¸­æ·»åŠ æ–°çš„èŠ‚ç‚¹å‡½æ•°
2. æ›´æ–°å›¾ç»“æ„ï¼Œæ·»åŠ æ–°çš„æ¡ä»¶è¾¹
3. åœ¨æ„å›¾åˆ†ç±»ä¸­æ·»åŠ æ–°çš„å…³é”®è¯

### æ·»åŠ æ–°çš„ç™»å½•åæ“ä½œ
1. åœ¨ä¸»å›¾çš„ç™»å½•åå¤„ç†é€»è¾‘ä¸­æ·»åŠ æ–°çš„å…³é”®è¯æ£€æµ‹
2. åˆ›å»ºå¯¹åº”çš„ä¸šåŠ¡å›¾æˆ–ç›´æ¥æ‰§è¡Œæ“ä½œ
3. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„æ„å›¾è·¯ç”±

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç™»å½•å¤±è´¥**
   - æ£€æŸ¥è´¦å·é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - æŸ¥çœ‹ ChromeDriver æ˜¯å¦æ­£å¸¸å·¥ä½œ

2. **Rayware å›¾è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ç™»å½•æ˜¯å¦çœŸæ­£æˆåŠŸ
   - ç¡®è®¤é¡µé¢ URL æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹å…ƒç´ å®šä½æ˜¯å¦å‡†ç¡®

3. **æ„å›¾è¯†åˆ«é”™è¯¯**
   - æ£€æŸ¥å…³é”®è¯é…ç½®
   - ç¡®è®¤ç”¨æˆ·è¾“å…¥æ ¼å¼
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„æ„å›¾è¯†åˆ«ç»“æœ

### è°ƒè¯•æ–¹æ³•

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

2. **æ£€æŸ¥çŠ¶æ€å˜åŒ–**
```python
print(f"å½“å‰çŠ¶æ€: {state}")
```

3. **å•æ­¥æ‰§è¡Œ**
```python
# åˆ†åˆ«æµ‹è¯•ç™»å½•å’Œä¸šåŠ¡æ“ä½œ
result1 = auto_login(user_desc="wangyili")
result2 = rayware_module_graph.invoke(state)
```

## ğŸ“ æœ€ä½³å®è·µ

1. **æŒ‡ä»¤æ ¼å¼è§„èŒƒ**
   - ä½¿ç”¨æ¸…æ™°çš„åŠ¨è¯ï¼šç™»å½•ã€æ–°å»ºã€åˆ›å»ºã€æŸ¥çœ‹
   - æ˜ç¡®æŒ‡å®šç”¨æˆ·ï¼šuser1ã€wangyili
   - æ˜ç¡®æŒ‡å®šæ“ä½œï¼šæ‰“å°ä»»åŠ¡ã€å†å²

2. **é”™è¯¯å¤„ç†**
   - æ¯ä¸ªæ­¥éª¤éƒ½æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
   - å¤±è´¥æ—¶ä¼šæä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
   - æ”¯æŒé‡è¯•æœºåˆ¶

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¤ç”¨æµè§ˆå™¨å®ä¾‹
   - æ™ºèƒ½å…ƒç´ å®šä½
   - å¼‚æ­¥æ“ä½œæ”¯æŒ

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªæ¡†æ¶ï¼Œä½ å¯ä»¥ç”¨ä¸€å¥è¯å®Œæˆå¤æ‚çš„ä¸šåŠ¡æ“ä½œï¼š

```
"ç”¨wangyiliç™»å½•å¹¶æ–°å»ºæ‰“å°ä»»åŠ¡"
```

æ¡†æ¶ä¼šè‡ªåŠ¨ï¼š
1. è§£ææŒ‡ä»¤æ„å›¾
2. æ‰§è¡Œç™»å½•æ“ä½œ
3. å¯¼èˆªåˆ°ä¸šåŠ¡ç³»ç»Ÿ
4. æ‰§è¡Œå…·ä½“ä¸šåŠ¡æ“ä½œ
5. è¿”å›æ‰§è¡Œç»“æœ

è¿™å¤§å¤§ç®€åŒ–äº†è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¤æ‚åº¦ï¼Œæé«˜äº†æµ‹è¯•æ•ˆç‡ã€‚ 